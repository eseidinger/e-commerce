-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=localhost;service_name=XEPDB1;port=1521

SET client_encoding TO 'UTF8';

\set ON_ERROR_STOP ON


CREATE OR REPLACE FUNCTION ora2pg_upd_autoincrement_seq (tbname text, colname text) RETURNS VOID AS $body$
DECLARE
        query text;
        maxval bigint;
        seqname text;
BEGIN
        query := 'SELECT max(' || colname || ')+1 FROM ' || tbname || '';
        EXECUTE query INTO maxval;
        IF (maxval IS NOT NULL) THEN
		query := $$SELECT pg_get_serial_sequence ('$$|| tbname || $$', '$$ || colname || $$');$$;
                EXECUTE query INTO seqname;
                IF (seqname IS NOT NULL) THEN
                        query := 'ALTER SEQUENCE ' || seqname || ' RESTART WITH ' || maxval;
                        EXECUTE query;
                END IF;
        ELSE
                RAISE NOTICE 'Table % is empty, you must load the AUTOINCREMENT file after data import.', tbname;
        END IF;
END;
$body$
LANGUAGE PLPGSQL;

SELECT ora2pg_upd_autoincrement_seq('categories','category_id');
SELECT ora2pg_upd_autoincrement_seq('customers','customer_id');
SELECT ora2pg_upd_autoincrement_seq('orders','order_id');
SELECT ora2pg_upd_autoincrement_seq('order_items','order_item_id');
SELECT ora2pg_upd_autoincrement_seq('products','product_id');
DROP FUNCTION ora2pg_upd_autoincrement_seq(text, text);
